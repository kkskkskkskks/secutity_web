<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>전체 상품</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    .container {
      display: flex;
      width: 1000px;
      margin: 50px auto;
    }

    .sidebar {
      width: 200px;
      padding-right: 20px;
      border-right: 1px solid #ccc;
    }

    .sidebar h3 {
      margin-top: 0;
    }

    .sidebar ul {
      list-style: none;
      padding-left: 0;
    }

    .sidebar li {
      margin-bottom: 10px;
    }

    .sidebar a {
      text-decoration: none;
      color: #333;
    }

    .main-content {
      flex: 1;
      padding-left: 30px;
    }

    .product-list {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .product-item {
      width: 200px;
      text-align: center;
    }

    .product-item img {
      width: 100%;
      height: 200px;
      object-fit: contain;
      margin-bottom: 10px;
    }

    .admin-actions {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  {% include 'navbar.html' %}

  <div class="container">
    <!-- 왼쪽: 카테고리 사이드바 -->
    <div class="sidebar">
      <h3>Category</h3>
      <ul>
        <li>
          <a href="{{ url_for('product_bp.products') }}"
             {% if not selected %}style="font-weight:bold;"{% endif %}>
            All
          </a>
        </li>
        {% for cat in categories %}
        <li>
          <a href="{{ url_for('product_bp.products', category=cat['category']) }}"
             {% if selected == cat['category'] %}style="font-weight:bold;"{% endif %}>
            {{ cat['category'] }}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>

    <!-- 오른쪽: 상품 목록 + 관리자 기능 -->
    <div class="main-content">
      <!-- 수정된 부분 시작 -->
      <h1>상품 목록</h1>
      <form method="get"
            action="{{ url_for('product_bp.products') }}"
            style="margin-bottom:20px;">
        <input type="text"
               name="q"
               placeholder="상품 검색"
               value="{{ search_query or '' }}">
        {% if selected %}
          <input type="hidden"
                 name="category"
                 value="{{ selected }}">
        {% endif %}
        <button type="submit">검색</button>
      </form>
      <h1>product</h1>

      <!-- 관리자: 신규 등록 링크 -->
      {% if session.get('is_admin') %}
      <div class="admin-actions">
        <a href="{{ url_for('product_bp.create_product') }}">+ 새 상품 등록</a>
      </div>
      {% endif %}

      <div class="product-list">
        {% for product in products %}
        <div class="product-item">
          <a href="{{ url_for('product_bp.product_detail', product_id=product['id']) }}">
            <img src="{{ url_for('static', filename='images/' + product['image']) }}"
                 alt="{{ product['name'] }}">
            <p>{{ product['name'] }}</p>
            <p class="price">{{ product['price'] }}&#x20a9;</p>
          </a>

          <!-- 관리자: 삭제 버튼 -->
          {% if session.get('is_admin') %}
          <form method="post"
                action="{{ url_for('product_bp.delete_product', product_id=product['id']) }}"
                style="margin-top:8px;">
            <button type="submit">삭제</button>
          </form>
          {% endif %}
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</body>
</html>